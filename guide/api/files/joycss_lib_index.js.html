<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>joycss/lib/index.js - editor-plugins</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="editor-plugins"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: editor-plugins 1.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/BackColor.html">BackColor</a></li>
            
                <li><a href="../classes/Bold.html">Bold</a></li>
            
                <li><a href="../classes/Button.html">Button</a></li>
            
                <li><a href="../classes/CheckBoxSourceArea.html">CheckBoxSourceArea</a></li>
            
                <li><a href="../classes/Code.html">Code</a></li>
            
                <li><a href="../classes/Draft.html">Draft</a></li>
            
                <li><a href="../classes/DragUpload.html">DragUpload</a></li>
            
                <li><a href="../classes/ElementPath.html">ElementPath</a></li>
            
                <li><a href="../classes/Flash.html">Flash</a></li>
            
                <li><a href="../classes/FontColor.html">FontColor</a></li>
            
                <li><a href="../classes/FontFamily.html">FontFamily</a></li>
            
                <li><a href="../classes/FontSize.html">FontSize</a></li>
            
                <li><a href="../classes/Heading.html">Heading</a></li>
            
                <li><a href="../classes/Image.html">Image</a></li>
            
                <li><a href="../classes/Indent.html">Indent</a></li>
            
                <li><a href="../classes/Italic.html">Italic</a></li>
            
                <li><a href="../classes/JustifyCenter.html">JustifyCenter</a></li>
            
                <li><a href="../classes/JustifyLeft.html">JustifyLeft</a></li>
            
                <li><a href="../classes/JustifyRight.html">JustifyRight</a></li>
            
                <li><a href="../classes/Link.html">Link</a></li>
            
                <li><a href="../classes/Maximize.html">Maximize</a></li>
            
                <li><a href="../classes/MultipleUpload.html">MultipleUpload</a></li>
            
                <li><a href="../classes/OrderedList.html">OrderedList</a></li>
            
                <li><a href="../classes/Outdent.html">Outdent</a></li>
            
                <li><a href="../classes/PageBreak.html">PageBreak</a></li>
            
                <li><a href="../classes/parserlib.css.PropertyValuePart.html">parserlib.css.PropertyValuePart</a></li>
            
                <li><a href="../classes/Preview.html">Preview</a></li>
            
                <li><a href="../classes/RemoveFormat.html">RemoveFormat</a></li>
            
                <li><a href="../classes/Resize.html">Resize</a></li>
            
                <li><a href="../classes/Separator.html">Separator</a></li>
            
                <li><a href="../classes/Smiley.html">Smiley</a></li>
            
                <li><a href="../classes/SourceArea.html">SourceArea</a></li>
            
                <li><a href="../classes/StrikeThrough.html">StrikeThrough</a></li>
            
                <li><a href="../classes/Table.html">Table</a></li>
            
                <li><a href="../classes/Underline.html">Underline</a></li>
            
                <li><a href="../classes/Undo.html">Undo</a></li>
            
                <li><a href="../classes/UnorderedList.html">UnorderedList</a></li>
            
                <li><a href="../classes/Video.html">Video</a></li>
            
                <li><a href="../classes/XiaMiMusic.html">XiaMiMusic</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/back-color.html">back-color</a></li>
            
                <li><a href="../modules/bold.html">bold</a></li>
            
                <li><a href="../modules/button.html">button</a></li>
            
                <li><a href="../modules/checkbox-source-area.html">checkbox-source-area</a></li>
            
                <li><a href="../modules/code.html">code</a></li>
            
                <li><a href="../modules/draft.html">draft</a></li>
            
                <li><a href="../modules/drag-upload.html">drag-upload</a></li>
            
                <li><a href="../modules/eindent.html">eindent</a></li>
            
                <li><a href="../modules/element-path.html">element-path</a></li>
            
                <li><a href="../modules/flash.html">flash</a></li>
            
                <li><a href="../modules/font-color.html">font-color</a></li>
            
                <li><a href="../modules/font-family.html">font-family</a></li>
            
                <li><a href="../modules/font-size.html">font-size</a></li>
            
                <li><a href="../modules/heading.html">heading</a></li>
            
                <li><a href="../modules/image.html">image</a></li>
            
                <li><a href="../modules/italic.html">italic</a></li>
            
                <li><a href="../modules/justify-center.html">justify-center</a></li>
            
                <li><a href="../modules/justify-left.html">justify-left</a></li>
            
                <li><a href="../modules/justify-right.html">justify-right</a></li>
            
                <li><a href="../modules/link.html">link</a></li>
            
                <li><a href="../modules/maximize.html">maximize</a></li>
            
                <li><a href="../modules/multiple-upload.html">multiple-upload</a></li>
            
                <li><a href="../modules/ordered-list.html">ordered-list</a></li>
            
                <li><a href="../modules/outdent.html">outdent</a></li>
            
                <li><a href="../modules/page-break.html">page-break</a></li>
            
                <li><a href="../modules/preview.html">preview</a></li>
            
                <li><a href="../modules/remove-format.html">remove-format</a></li>
            
                <li><a href="../modules/resize.html">resize</a></li>
            
                <li><a href="../modules/separator.html">separator</a></li>
            
                <li><a href="../modules/smiley.html">smiley</a></li>
            
                <li><a href="../modules/source-area.html">source-area</a></li>
            
                <li><a href="../modules/strike-through.html">strike-through</a></li>
            
                <li><a href="../modules/table.html">table</a></li>
            
                <li><a href="../modules/underline.html">underline</a></li>
            
                <li><a href="../modules/undo.html">undo</a></li>
            
                <li><a href="../modules/unordered-list.html">unordered-list</a></li>
            
                <li><a href="../modules/video.html">video</a></li>
            
                <li><a href="../modules/xiami-music.html">xiami-music</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: joycss/lib/index.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**!
 * api入口文件
 *
 * Copyright(c) Eward.song Limited.
 * MIT Licensed
 *
 * Authors:
 *   Eward &lt;eward.song@gmail.com&gt; (http://shepherdwind.com)
 */

&#x27;use strict&#x27;;
/**
 * Joycss对象
 *
 * @param {string} input css来源，可以是css文件、less、sass文件，或者一个包含图
 * 片文件夹，或者cssText字符串
 * @param {object} option
 *
 */
var defaultOption = {
  /**
   * 图片目标地址，如果没有指定，默认图片和生成的css地址一致
   */
  destImg: null,
  /**
   * 生成css地址，如果不指定，和源css路径一致
   */
  destCss: null,
  /**
   * cssText，css字符串，当存在cssText，不需要从文件中读取css字符串，第一参数
   * filename用于查找css中图片路径，比如css中图片../size.png，filename是/a/b/
   * 那么图片的绝对路径就是/a/size.png
   */
  cssText: null,
  /**
   * 使用png8模式，如果设置为false，生成png24图
   */
  force8bit : true,
  /**
   * 拼图算法，支持三种&#x27;auto | close | vertical | horizontal&#x27;
   * auto自动拼图，如果知道图片所在的盒子大小，使用紧凑拼图，否则独占一行
   * close: 紧凑拼图，搜有图片使用紧凑拼图
   * vertical: 垂直布局,
   * horizontal: 水平布局
   */
  layout : &#x27;auto&#x27;,

  // 是否保存css文件到destCss
  save: true,

  // 图片命令行工具，支持php或者java，如果没有尝试执行php和java，自动选择
  api: &#x27;auto&#x27;
};

var path = require(&#x27;path&#x27;);
var fs = require(&#x27;co-fs&#x27;);
var mkdirp = require(&#x27;mkdirp&#x27;);
var thunkify = require(&#x27;thunkify&#x27;);
var unyield = require(&#x27;unyield&#x27;);

var utils = require(&#x27;./common/utils&#x27;);
var logger = require(&#x27;./common/logger&#x27;);

mkdirp = thunkify(mkdirp);

function Joycss(filename, option){

  if (!filename) {
    throw new Error(&#x27;css文件路径不能为空&#x27;);
  }

  if (!(this instanceof Joycss)) {
    return new Joycss(filename, option);
  }

  logger.debug(&#x27;拼图开始------------------&#x27;);
  this.filename = filename;
  this.option = utils.mixin(defaultOption, {});
  utils.mixin(option, this.option);

  global.joycssApi = &#x27;java&#x27;;

  this.initialize();
}

// 判断输入类型
Joycss.prototype.type = function(){
  var filename = this.filename;
  var option = this.option;
  if (option.cssText) return &#x27;string&#x27;;

  var ext = path.extname(filename);
  if (ext === &#x27;.css&#x27;) return &#x27;css&#x27;;
  if (!ext) return &#x27;dir&#x27;;

  return &#x27;other&#x27;;
};

var EXT_REG = /\.\w{2,4}$/;

Joycss.prototype.initialize = function(){
  var option = this.option;
  var filename = this.filename;
  var type = this.type();

  // 如果传入的是css字符串，filename是一个目录的情况，自动补全css路径
  if (type === &#x27;string&#x27; &amp;&amp; !path.extname(filename)) {
    filename = filename + &#x27;/joyss.css&#x27;;
    this.filename = filename;
  }

  // 如果目标css地址没有设置或者图片地址未设置，和源css路径在一起，比如
  // a.css =&gt; a-sprite.css, a-sprite.png
  if (type === &#x27;css&#x27;) {
    option.destCss = option.destCss ||
      filename.replace(EXT_REG, &#x27;-sprite.css&#x27;);
  }

  // 如果是less之类的，直接返回同名的css文件，比如
  // a.less =&gt; a.css
  if (type === &#x27;other&#x27;) {
    option.destCss = option.destCss ||
      filename.replace(EXT_REG, &#x27;.css&#x27;);
  }

  // 如果是一个文件夹的情况，默认生成和文件夹同名的css文件
  if (type === &#x27;dir&#x27;) {
    option.destCss = option.destCss ||
      path.join(filename, path.basename(filename) + &#x27;.css&#x27;);
  }

  option.destImg = option.destImg ||
    option.destCss.replace(EXT_REG, &#x27;-sprite.png&#x27;);

};

Joycss.prototype.run = unyield(function* (){
  var union = require(&#x27;./union&#x27;);
  var cssText = yield union.merge(this.filename, this.option);
  var option = this.option;
  if (this.option.save) {
    logger.debug(&#x27;开始写入到文件%s&#x27;, option.destCss);
    yield mkdirp(path.dirname(option.destCss));
    yield fs.writeFile(option.destCss, cssText);
    logger.success(&#x27;写入文件%s成功&#x27;, option.destCss);
  }

  logger.success(&#x27;拼图完成&#x27;);
  return cssText;
});

Joycss.Log = logger;
module.exports = Joycss;

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
